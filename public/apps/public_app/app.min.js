!function(){angular.module("homeCtrl",["authService","userService"]).controller("homeController",function($http,$scope,$rootScope,Auth,User){function checkedLoggedInStatus(){vm.loggedIn=Auth.isLoggedIn()}function getUser(){vm.loggedIn&&Auth.getUser().then(function(res){console.log(res),vm.user=res.data.user})}var vm=this;vm.loggedIn,vm.user,checkedLoggedInStatus(),getUser()})}(),function(){angular.module("loginCtrl",["authService","userService"]).controller("loginController",function($http,$scope,$rootScope,Auth,User,$location){var vm=this;vm.doLogin=function(){Auth.login(vm.loginData.username,vm.loginData.password).success(function(data){$location.path("/")}).error(function(err){console.log(err)})}})}(),function(){angular.module("devCode",["app.routes","homeCtrl","loginCtrl","userService","authService","globalsService"]).config(function($httpProvider){$httpProvider.interceptors.push("AuthInterceptor")})}(),function(){var route=angular.module("app.routes",["ngRoute"]);route.config(function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"apps/public_app/views/home.html",controller:"homeController",controllerAs:"home"}).when("/login",{templateUrl:"apps/public_app/views/login.html",controller:"loginController",controllerAs:"login"})})}(),function(){angular.module("authService",["globalsService"]).factory("Auth",function($http,$q,AuthToken,Globals){var factory={};return factory.login=function(username,password){return $http.post(Globals.API_ROOT+"/api/users/authenticate",{username:username,password:password}).success(function(data){return AuthToken.setToken(data.token),data})},factory.logout=function(){AuthToken.setToken()},factory.isLoggedIn=function(){return!!AuthToken.getToken()},factory.getUser=function(){return AuthToken.getToken()?$http.get(Globals.API_ROOT+"/api/users/me",{cache:!0}):$q.reject({message:"User has no token"})},factory}).factory("AuthToken",function($window){var factory={};return factory.getToken=function(){return $window.localStorage.getItem("token")},factory.setToken=function(token){token?$window.localStorage.setItem("token",token):$window.localStorage.removeItem("token")},factory}).factory("AuthInterceptor",function($q,$location,AuthToken){var factory={};return factory.request=function(config){var token=AuthToken.getToken();return token&&(config.headers["x-access-token"]=token),config},factory.responseError=function(response){return 403==response.status&&$location.path("/login"),$q.reject(response)},factory})}(),function(){angular.module("globalsService",[]).factory("Globals",function(){var factory={};return factory.API_ROOT="http://localhost:8080",factory})}(),function(){angular.module("userService",["globalsService"]).factory("User",function($http,Globals){var factory={};return factory.getAll=function(){return $http.get("/api/users")},factory.getMe=function(){return $http.get("/api/users/me")},factory})}();